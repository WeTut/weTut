{% extends "layout/base.html" %}

{% block content %}

<script type="text/javascript">
	var title = $('title').text();
	$('title').html('Poser une question | ' + title);
</script>

{% if user.is_authenticated %}
		<div id="ask_banner">
			<div id="content_banner">
				<p>Pose ta question</p>
			</div>
		</div>

	<div class="content" style="margin-top:30px;">

		<p style="font-style:italic; color:#9c9c9c; font-size:12px;">* Champs obligatoires</p>
	
		<form id="questionForm" action="" method="post" enctype="multipart/form-data">
			{% csrf_token %}
			<div class="row-fluid marketing">
				<div class='span6'>
					<p><input type="text" name="title" placeholder="Title*"  id="id_title" class="" size="40" title="Title*" /></p>

					<div class="mainPicture">
					<div class="fileinputs">
						<div style="display:none">{{form.picture}}</div>
						<div class="fakefile">
							<input type="text" name="filename" class="filevisible" placeholder="Selectionner une image*">
							<div class="file_img">
								<img src="/static/images/pictos/upload.png" onclick="$('#id_picture').click();">
							</div>
						</div>
					</div>
					</div>
					
					<p style="font-style:italic; color:#9c9c9c; font-size:12px; position:relative; margin-top:8px;">(Format JPEG, PNG, GIF , minimum 240 x 120px)</p>
					
					
				</div>
				<div class='span6'>
					<p>
						<textarea type="text" name="message" placeholder="Message*"  id="id_message" class="" size="400" title="Message*"></textarea>
					</p>
				</div>
			</div>
			<div class="clear"></div>
			<p class="subtitle_ask">Ajouter des tags (1 minimum, 3 maximum)</p>
			<div class="row-fluid">
				<div class="span4">
					<div id="tag1" class="ui-widget">
						<label>Tag 1</label>
							<div class="styled_select_ask">
								<select name="technical1" class="technical">
									<option value="0">TECHNIQUE</option>
									{% for technical in technicaltags %}
										<option value="{{technical.id}}">{{technical.name}}</option>
									{% endfor %}
								</select>
							</div>
							<div class="styled_select_ask">
								<select name="software1" class="software">
									<option value="0">LOGICIEL</option>
									{% for software in softwaretags %}
										<option value="{{software.id}}">{{software.name}}</option>
									{% endfor %}
								</select>
							</div>
						</div>
					</div>
				<div class="span4">
					<div id="tag2" style="display:none;" class="ui-widget">
						<label>Tag 2</label>
						<div class="styled_select_ask">
							<select name="technical2" class="technical">
								<option value="0">TECHNIQUE</option>
								{% for technical in technicaltags %}
									<option value="{{technical.id}}">{{technical.name}}</option>
								{% endfor %}
							</select>
						</div>
						<div class="styled_select_ask">
							<select name="software2" class="software">
								<option value="0">LOGICIEL</option>
								{% for software in softwaretags %}
									<option value="{{software.id}}">{{software.name}}</option>
								{% endfor %}
							</select>
						</div>
					</div>
				</div>
				<div class="span4">
					<div id="tag3" style="display:none;" class="ui-widget">
						<label>Tag 3</label>
						<div class="styled_select_ask">
							<select name="technical3" class="technical">
								<option value="0">TECHNIQUE</option>
								{% for technical in technicaltags %}
									<option value="{{technical.id}}">{{technical.name}}</option>
								{% endfor %}
							</select>
						</div>
						<div class="styled_select_ask">
							<select name="software3" class="software">
								<option value="0">LOGICIEL</option>
								{% for software in softwaretags %}
									<option value="{{software.id}}">{{software.name}}</option>
								{% endfor %}
							</select>
						</div>
					</div>
				</div>
			</div>
			
			<p class="subtitle_ask">Ajouter des images</p>
			<p class="subtitle_ask2">Illustrez votre question avec jusqu'à 3 images supplémentaires</p>

			<div class="row-fluid marketing addImages">
				<div class='span4'><a href="" class="addMedia">+</a><p class="firstMedia">Première image <input type="file" name="media1" onchange="readURL(this);"/> <img src="#" alt="" /></p></div>
				<div class='span4'><a href="" class="addMedia">+</a><p class="secondMedia">Deuxième image<input type="file" name="media2" onchange="readURL(this);"/><img src="#" alt="" /></p></div>
				<div class='span4'><a href="" class="addMedia">+</a><p class="thirdMedia">Troisième image <input type="file" name="media3" onchange="readURL(this);"/><img src="#" alt="" /></p></div>
			</div>

			<p class="subtitle_ask">Ajouter une vidéo</p>
			<p class="subtitle_ask2">Illustrez votre question en ajoutant une vidéo depuis YouTube</p>

			<input type="text" name="video" id="video" />

			<div class="previsuVideo">
				<object width="560" height="315"><param name="movie" value=""></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="" type="application/x-shockwave-flash" width="560" height="315" allowscriptaccess="always" allowfullscreen="true"></embed></object>
			</div>
			
			<div class="row-fluid marketing">
				<div class='span4'></div>
				<div class='span4'><input type="submit" class="ask_your_question_button" value="Pose ta question" /></div>
				<div class='span4'></div>
			</div>

			<script type="text/javascript">

        $(document).ready(function() {
        	$('.addImages .span4 p').hide();
        	$('a.addMedia').click(function() {
        		$(this).fadeOut(function() {
        			$(this).next('p').fadeIn();
        		});
        		return false;
        	});

        	$('div.previsuVideo').hide();
        	$("input#video").live('change', function(){ 
        		var urlVideo = 'http://www.youtube.com/v/' + $(this).attr('value').split('?v=')[1] + '?version=3&amp;hl=fr_FR&amp;rel=0';
        		$('.previsuVideo param[name=movie]').attr('value',urlVideo);
        		$('.previsuVideo embed').attr('src',urlVideo);
        		$('div.previsuVideo').show();
        	});

        })

        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $(input).next('img')
                        .attr('src', e.target.result)
                        .width(250);
                    $(input).next().next().next('a').show();
                };

                reader.readAsDataURL(input.files[0]);
            }
        }

        
    </script>

		</form>
	
		<script type="text/javascript">  
			$(document).ready( function(){ 	
				$("#id_picture").change( function(){ $(".filevisible").attr("value", document.getElementById("id_picture").files[0].name ); }); 
			});
		</script> 
		
		<script>
		  
			 (function( $) {
			    $.widget( "ui.combobox", {
			      _create: function() {
			
			        var input,
			          self = this,
			          select = this.element.hide(),
			          selected = select.children( ":selected" ),
			          value = selected.val() ? selected.text() : "",
			          wrapper = this.wrapper = $( "<span>" )
			            .addClass( "ui-combobox" )
			            .insertAfter( select );
			                        
			                var placeholder = select.attr('id');                    
			        input = $( "<input class='placeholder' placeholder='" + placeholder + "'>" )
			          .appendTo( wrapper )
			          .addClass( "ui-state-default ui-combobox-input" )
			          .autocomplete({
			            delay: 0,
			            minLength: 0,
			            source: function( request, response ) {
			              var matcher = new RegExp( $.ui.autocomplete.escapeRegex(request.term), "i" );
			              response( select.children( "option" ).map(function() {
			                var text = $( this ).text();
			                if ( this.value && ( !request.term || matcher.test(text) ) )
			                  return {
			                    label: text.replace(
			                      new RegExp(
			                        "(?![^&;]+;)(?!<[^<>]*)(" +
			                        $.ui.autocomplete.escapeRegex(request.term) +
			                        ")(?![^<>]*>)(?![^&;]+;)", "gi"
			                      ), "<strong>$1</strong>" ),
			                    value: text,
			                    option: this
			                  };
			              }) );
			            },
			            select: function( event, ui ) {
			              ui.item.option.selected = true;
			              self._trigger( "selected", event, {
			                item: ui.item.option
			              });
			            },
			            change: function( event, ui ) {
			              if ( !ui.item ) {
			                var matcher = new RegExp( "^" + $.ui.autocomplete.escapeRegex( $(this).val() ) + "$", "i" ),
			                  valid = false;
			                select.children( "option" ).each(function() {
			                  if ( $( this ).text().match( matcher ) ) {
			                    this.selected = valid = true;
			                    return false;
			                  }
			                });
			                if ( !valid ) {
			                  // remove invalid value, as it didn't match anything
			                  $( this ).val( "" );
			                  select.val( "" );
			                  input.data( "autocomplete" ).term = "";
			                  return false;
			                }
			              }
			            }
			          })
			          .addClass( "ui-widget ui-widget-content ui-corner-left" );
			                                        
			                                        // This line added to set default value of the combobox
			                                        if ($(select).hasClass('default-select')){
			                                            input.val($(select).find("option:selected").text());
			                                        }
			
			        input.data( "autocomplete" )._renderItem = function( ul, item ) {
			          return $( "<li></li>" )
			            .data( "item.autocomplete", item )
			            .append( "<a>" + item.label + "</a>" )
			            .appendTo( ul );
			        };
			
			        $( "<a>" )
			          .attr( "tabIndex", -1 )
			          .attr( "title", "Show All Items" )
			          .appendTo( wrapper )
			          .button({
			            icons: {
			              primary: "ui-icon-triangle-1-s"
			            },
			            text: false
			          })
			          .removeClass( "ui-corner-all" )
			          .addClass( "ui-corner-right ui-combobox-toggle" )
			          .click(function() {
			            // close if already visible
			            if ( input.autocomplete( "widget" ).is( ":visible" ) ) {
			              input.autocomplete( "close" );
			              return;
			            }
			
			            // work around a bug (likely same cause as #5265)
			            $( this ).blur();
			
			            // pass empty string as value to search for, displaying all results
			            input.autocomplete( "search", "" );
			            input.focus();
			          });
			      },
			
			      destroy: function() {
			        this.wrapper.remove();
			        this.element.show();
			        $.Widget.prototype.destroy.call( this );
			      }
			    });
			  })( jQuery );
			
			  $(function() {
			    $( ".combobox" ).combobox();
			    $( "#toggle" ).click(function() {
			      $( ".combobox" ).toggle();
			    });
			  });
		  </script>
		</div>
  {% endif %}

{% endblock content %}

