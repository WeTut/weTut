{% extends "layout/base.html" %}


{% block content %}


 <!-- START BANNER--> 

 		<div class="banner_questions">
 			<div class="content_banner_questions">
 				<div class="questions_filters">
					<form id='filterform' action="" method="POST">
						{% csrf_token %}
				        <ul>
				        {{ filterform.as_ul}}	        
				        </ul>
				        <input name="submit" type="hidden" value="filterSubmit" />
			        </form>
			
			
			        <div id='filtertag' >
						{% for tag in tags %}
							<a {% if currentag == tag.id %}class='bold'{% endif %} href="/questions?tag={{tag.id}}">{{tag.name}}</a> | 
						{% endfor %}
							<a {% if currentag == 0 %}class='bold'{% endif %} href="/questions">tous</a>
			        </div>
			        <br />
			
			        
			        {% if user.is_authenticated %}
						{% if currentag != 0 %}
						<div>
							<form  class="followTagForm" action="" method="post" enctype="multipart/form-data">
								{% csrf_token %}
								<input class="tagId" type="hidden" name="tagId" value="{{currentag}}"></input>
								<div class='follow'>
									<input name="hidden" type="hidden" value="{% if userfollowstag %}unfollow{% else %}follow{% endif %}" />
									<button class='btn btn-{% if userfollowstag %}danger{% else %}primary{% endif %} btn-block vcenter' name='submit' type="submit" value="followTagSubmit">{% if userfollowstag %}Ne plus suivre{% else %}Suivre ce tag{% endif %}</button>
								</div>
							</form>
						</div>
			        	{% endif %}
					{% endif %}	
				</div>
			</div>					
		</div>
 <!-- END BANNER-->      

<div class="content">
	<div class="ask_questions_button"><a href="/questions/ask"><p>Poser une question</p></a></div>
	<div id="questions">
    {% if not questions %}
    	<div style="position:relative;">
    		<p>Il n'y a pas de question dans cette catégorie</p><br />
    	</div>

    {% else %}

	{% for question in questions %}
			<div id="question{{question.id}}" class="one_question">
				<div class="img">
					<a href='{{question.slug}}'>
									<img class='image_one_question' src='{{question.picture.thumbnail.url}}'/>
								</a>
				</div>
				<div class="member">
					<div class="img_member">
						{% if question.user.profile.avatar.url != "" %}
     						<img src='{{question.user.profile.avatar.url}}'/>
						{% else %}
							<img src="{{MEDIA_URL}}members/avatar.jpg"/>
						{% endif %}
					</div>
					<div class="infos_member">
						<div class="view">
							<img src="{{STATIC_URL}}images/pictos/view_questions_wetut.png">
							<p>{{ question.views }}</p>
						</div>
						<div class="responses">
							<img src="{{STATIC_URL}}images/pictos/bulle_questions_wetut.png">
							<p>{{ question.getAnswersCount }}</p>
						</div>
					</div>
				</div>
				<div class="infos_questions">
					<div class="title"><a href='{{question.slug}}'>{{ question.title }}</a></div>
					<div class="date"><p>Par {{question.user}}</p> <p style="font-style:italic; font-size:10px; margin-top:1px;">le {{question.date}}</p></div>
					<div class="tags"></div>
					<div class="text"><p>{{ question.message|truncatechars:80 }}</p></div>
				</div>
				<div class="action_member">
					<a href="">
					<div class="answer">
						<img src="{{STATIC_URL}}images/pictos/answer_picto.png"><p>Je sais !</p>
					</div>
					</a>
					<div class="question_follow">
					{% if user.is_authenticated %}
						<form  class="followForm" action="" method="post" enctype="multipart/form-data">
						{% csrf_token %}
						<input class="questionId" type="hidden" name="questionId" value="{{question.id}}"></input>
						<div class='follow'>
							<input name="hidden" type="hidden" value="{% if question.currentUserFollows %}unfollow{% else %}follow{% endif %}" />
							<button class='btn-{% if question.currentUserFollows %}ok{% else %}nok{% endif %}' name='submit' type="submit" value="followSubmit">{% if question.currentUserFollows %}Ne plus suivre{% else %}Suivre{% endif %}</button>
						</div>
						</form>
					{% endif %}	
					</div>	
			</div>
			</div>
	{% endfor %}

{% endif %}
	</div>

	<div class="pagination">
	    <span class="step-links">
	        {% if questions.has_previous %}
	            <a href="?page={{ questions.previous_page_number }}">précédent</a>
	        {% endif %}

	        <span class="current">
	            Page {{ questions.number }} sur {{ questions.paginator.num_pages }}
	        </span>

	        {% if questions.has_next %}
	            <a href="?page={{ questions.next_page_number }}">suivant</a>
	        {% endif %}
	    </span>
	</div>


	<div class="clear"></div>
	<div class="ask_questions_button"><a href="/questions/ask"><p>Poser une question</p></a></div>
</div>


<script type="text/javascript">
$(document).ready( function(){
 	$('#filterform option[value={{filtervalue}}]').attr("selected", "selected");
}); 


</script>


{% endblock content %}

